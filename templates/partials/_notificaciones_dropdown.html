<div class="list-group list-group-flush" style="min-width:260px;">
    {% if notificaciones %}
        {% for n in notificaciones %}
            {# Si la notificación tiene una URL, usarla (y anexar from_notification para usuarios no superuser). #}
            {% if n.url %}
                {% if 'inspección' in n.titulo|lower %}
                    {% if request.user.is_superuser %}
                        <a href="{{ n.url }}" class="notif-item list-group-item list-group-item-action d-flex justify-content-between align-items-start {% if not n.leida %}fw-bold{% endif %}" data-id="{{ n.id }}" data-unread="{% if not n.leida %}1{% else %}0{% endif %}" style="font-size:0.85rem; border-left: 3px solid #ffc107;">
                    {% else %}
                        <a href="{{ n.url }}?from_notification={{ n.id }}" class="notif-item list-group-item list-group-item-action d-flex justify-content-between align-items-start {% if not n.leida %}fw-bold{% endif %}" data-id="{{ n.id }}" data-unread="{% if not n.leida %}1{% else %}0{% endif %}" style="font-size:0.85rem; border-left: 3px solid #ffc107;">
                    {% endif %}
                {% elif 'aceptada' in n.titulo|lower or 'aprobada' in n.titulo|lower %}
                    {% if request.user.is_superuser %}
                        <a href="{{ n.url }}" class="notif-item list-group-item list-group-item-action d-flex justify-content-between align-items-start {% if not n.leida %}fw-bold{% endif %}" data-id="{{ n.id }}" data-unread="{% if not n.leida %}1{% else %}0{% endif %}" style="font-size:0.85rem; border-left: 3px solid #28a745;">
                    {% else %}
                        <a href="{{ n.url }}?from_notification={{ n.id }}" class="notif-item list-group-item list-group-item-action d-flex justify-content-between align-items-start {% if not n.leida %}fw-bold{% endif %}" data-id="{{ n.id }}" data-unread="{% if not n.leida %}1{% else %}0{% endif %}" style="font-size:0.85rem; border-left: 3px solid #28a745;">
                    {% endif %}
                {% elif 'rechazada' in n.titulo|lower %}
                    {% if request.user.is_superuser %}
                        <a href="{{ n.url }}" class="notif-item list-group-item list-group-item-action d-flex justify-content-between align-items-start {% if not n.leida %}fw-bold{% endif %}" data-id="{{ n.id }}" data-unread="{% if not n.leida %}1{% else %}0{% endif %}" style="font-size:0.85rem; border-left: 3px solid #dc3545;">
                    {% else %}
                        <a href="{{ n.url }}?from_notification={{ n.id }}" class="notif-item list-group-item list-group-item-action d-flex justify-content-between align-items-start {% if not n.leida %}fw-bold{% endif %}" data-id="{{ n.id }}" data-unread="{% if not n.leida %}1{% else %}0{% endif %}" style="font-size:0.85rem; border-left: 3px solid #dc3545;">
                    {% endif %}
                {% elif 'cancelada' in n.titulo|lower %}
                    {% if request.user.is_superuser %}
                        <a href="{{ n.url }}" class="notif-item list-group-item list-group-item-action d-flex justify-content-between align-items-start {% if not n.leida %}fw-bold{% endif %}" data-id="{{ n.id }}" data-unread="{% if not n.leida %}1{% else %}0{% endif %}" style="font-size:0.85rem; border-left: 3px solid #6c757d;">
                    {% else %}
                        <a href="{{ n.url }}?from_notification={{ n.id }}" class="notif-item list-group-item list-group-item-action d-flex justify-content-between align-items-start {% if not n.leida %}fw-bold{% endif %}" data-id="{{ n.id }}" data-unread="{% if not n.leida %}1{% else %}0{% endif %}" style="font-size:0.85rem; border-left: 3px solid #6c757d;">
                    {% endif %}
                {% else %}
                    {% if request.user.is_superuser %}
                        <a href="{{ n.url }}" class="notif-item list-group-item list-group-item-action d-flex justify-content-between align-items-start {% if not n.leida %}fw-bold{% endif %}" data-id="{{ n.id }}" data-unread="{% if not n.leida %}1{% else %}0{% endif %}" style="font-size:0.85rem; border-left: 3px solid #28a745;">
                    {% else %}
                        <a href="{{ n.url }}?from_notification={{ n.id }}" class="notif-item list-group-item list-group-item-action d-flex justify-content-between align-items-start {% if not n.leida %}fw-bold{% endif %}" data-id="{{ n.id }}" data-unread="{% if not n.leida %}1{% else %}0{% endif %}" style="font-size:0.85rem; border-left: 3px solid #28a745;">
                    {% endif %}
                {% endif %}
            {% else %}
                <a href="/notificaciones/detalle/{{ n.id }}/" class="notif-item list-group-item list-group-item-action d-flex justify-content-between align-items-start {% if not n.leida %}fw-bold{% endif %}" data-id="{{ n.id }}" data-unread="{% if not n.leida %}1{% else %}0{% endif %}" style="font-size:0.85rem;">
            {% endif %}
                <div class="me-2 text-truncate" style="max-width:170px;">
                    {% if 'transferencia' in n.titulo|lower %}
                        {% if 'inspección' in n.titulo|lower %}
                            <i class="fas fa-search text-warning me-1"></i>
                        {% elif 'aceptada' in n.titulo|lower or 'aprobada' in n.titulo|lower %}
                            <i class="fas fa-check-circle text-success me-1"></i>
                        {% elif 'rechazada' in n.titulo|lower %}
                            <i class="fas fa-times-circle text-danger me-1"></i>
                        {% elif 'cancelada' in n.titulo|lower %}
                            <i class="fas fa-ban text-secondary me-1"></i>
                        {% elif 'solicitud' in n.titulo|lower %}
                            <i class="fas fa-car text-success me-1"></i>
                        {% else %}
                            <i class="fas fa-exchange-alt text-primary me-1"></i>
                        {% endif %}
                    {% endif %}
                    {{ n.titulo|truncatechars:40 }}
                    <div class="small text-muted">{{ n.fecha_creacion|date:'d/m H:i' }}</div>
                </div>
                {% if not n.leida %}<span class="badge bg-danger rounded-pill" style="font-size:0.55rem;">NEW</span>{% endif %}
            </a>
        {% endfor %}
        <div class="text-center py-1">
            <a href="{% url 'notificaciones_usuario' %}" class="small">Ver todas</a>
        </div>
    {% else %}
        <div class="p-3 text-center small text-muted">Sin notificaciones</div>
    {% endif %}
</div>